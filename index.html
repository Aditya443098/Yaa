// ========== UPDATE VERSI ==========
const APP_VERSION = "2.0"; // Update versi
// ==================================

// ========== STATE TURNAMEN BARU ==========
let tournamentActive = false;
let tournamentScores = { X: 0, O: 0 };
const WIN_TARGET = 4; // Sistem 4 kemenangan

function startTournament() {
    tournamentActive = true;
    tournamentScores = { X: 0, O: 0 };
    
    // Tampilkan info turnamen
    document.getElementById('tournament-display').style.display = 'block';
    document.getElementById('game-title').textContent = 'TURNAMEN - 4 Wins';
    
    // Reset game
    gameState.gameActive = true;
    gameState.currentTurn = 'X';
    gameState.board = Array(gameState.boardSize * gameState.boardSize).fill('');
    
    initializeGameBoard();
    updateGameDisplay();
    updateTournamentScore();
    
    alert('ðŸ† TURNAMEN DIMULAI! ðŸ†\nMenangkan 4 kali untuk jadi juara!');
}

function updateTournamentScore() {
    if (tournamentActive) {
        document.getElementById('tournament-score-x').textContent = tournamentScores.X;
        document.getElementById('tournament-score-o').textContent = tournamentScores.O;
    }
}

function checkTournamentWinner() {
    if (tournamentScores.X >= WIN_TARGET) {
        return 'X';
    } else if (tournamentScores.O >= WIN_TARGET) {
        return 'O';
    }
    return null;
}

function endTournament(winner) {
    tournamentActive = false;
    
    // Beri hadiah
    const prize = 4000;
    gameState.coins += prize;
    
    // Tampilkan modal
    document.getElementById('champion-name').textContent = `Pemain ${winner}`;
    document.getElementById('final-score-x').textContent = tournamentScores.X;
    document.getElementById('final-score-o').textContent = tournamentScores.O;
    document.getElementById('champion-modal').classList.add('active');
    
    alert(`ðŸŽ‰ JUARA TURNAMEN! ðŸŽ‰\nPemain ${winner} menang ${WIN_TARGET} kali!\nHadiah: ${prize} koin!`);
}

// ========== UPDATE FUNGSI handleCellClick ==========
function handleCellClick(index) {
    // Kode existing...
    
    // Cek pemenang
    const winner = checkWinner();
    
    if (winner) {
        gameState.gameActive = false;
        
        if (winner === 'tie') {
            // Kode existing...
        } else {
            // Kode existing...
            
            // ====== TURNAMEN LOGIC ======
            if (tournamentActive && winner !== 'tie') {
                tournamentScores[winner]++;
                updateTournamentScore();
                
                // Cek juara turnamen
                const tournamentWinner = checkTournamentWinner();
                if (tournamentWinner) {
                    endTournament(tournamentWinner);
                    return;
                } else {
                    // Lanjut game berikutnya
                    setTimeout(() => {
                        gameState.gameActive = true;
                        gameState.currentTurn = 'X';
                        gameState.board = Array(gameState.boardSize * gameState.boardSize).fill('');
                        initializeGameBoard();
                        updateGameDisplay();
                    }, 1500);
                }
            }
            // ============================
        }
    }
}
// ==========================================

// ========== TAMBAH TOMBOL TURNAMEN ==========
document.addEventListener('DOMContentLoaded', function() {
    // Kode existing...
    
    // Tambah tombol turnamen
    const tournamentBtn = document.createElement('button');
    tournamentBtn.className = 'btn';
    tournamentBtn.innerHTML = '<i class="fas fa-trophy"></i> START TURNAMEN';
    tournamentBtn.id = 'tournament-btn';
    tournamentBtn.style.background = 'linear-gradient(to right, #9b59b6, #e056fd)';
    tournamentBtn.style.margin = '10px 0';
    
    tournamentBtn.addEventListener('click', function() {
        if (confirm('Mulai turnamen?\nMenangkan 4 game untuk jadi juara!')) {
            startTournament();
            showPage('game');
        }
    });
    
    // Masukkan tombol di menu
    const menuPage = document.getElementById('menu-page');
    const startGameBtn = document.getElementById('start-game-btn');
    menuPage.insertBefore(tournamentBtn, startGameBtn.nextSibling);
});
// ===========================================
