
// Initialize tournaments
function initTournaments() {
    const tournaments = [
        { id: 1, name: 'Turnamen Harian', status: 'ongoing', players: 65, prize: 500 },
        { id: 2, name: 'Turnamen Mingguan', status: 'upcoming', players: 0, prize: 2000 },
        { id: 3, name: 'Turnamen Bulanan', status: 'upcoming', players: 0, prize: 10000 }
    ];

    const container = document.getElementById('tournament-list');
    container.innerHTML = '';

    tournaments.forEach(tournament => {
        const joined = userData.tournamentProgress?.[tournament.id];
        
        const card = document.createElement('div');
        card.className = 'tournament-card';
        card.innerHTML = `
            <div class="tournament-header">
                <div class="tournament-title">${tournament.name}</div>
                <div class="tournament-status status-${tournament.status}">
                    ${tournament.status === 'ongoing' ? 'Berlangsung' : 'Akan Datang'}
                </div>
            </div>
            <div class="tournament-desc">
                <p>Hadiah: <strong>${tournament.prize} Coin</strong></p>
                <p>Peserta: ${tournament.players}/100</p>
                ${joined ? '<p class="joined-badge">âœ“ Anda sudah bergabung</p>' : ''}
            </div>
            ${tournament.status === 'ongoing' ? `
                <div class="tournament-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${tournament.players}%"></div>
                    </div>
                </div>
                <button class="btn ${joined ? 'btn-secondary' : 'btn-primary'} join-tournament-btn" 
                        data-id="${tournament.id}">
                    ${joined ? 'Lanjutkan' : 'Gabung'}
                </button>
            ` : '<button class="btn btn-secondary" disabled>Segera Hadir</button>'}
        `;
        
        container.appendChild(card);
    });

    // Event listeners for join buttons
    document.querySelectorAll('.join-tournament-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tournamentId = this.dataset.id;
            if (this.textContent === 'Gabung') {
                joinTournament(tournamentId);
            } else {
                continueTournament(tournamentId);
            }
        });
    });
}

// Join tournament
function joinTournament(tournamentId) {
    if (!userData.tournamentProgress) userData.tournamentProgress = {};
    
    userData.tournamentProgress[tournamentId] = {
        joined: true,
        wins: 0,
        losses: 0,
        round: 1
    };
    
    saveUserData();
    initTournaments();
    alert('Bergabung turnamen berhasil!');
}

// Continue tournament
function continueTournament(tournamentId) {
    alert('Memulai pertandingan turnamen...');
    // Set game mode to tournament
    gameState.gameMode = 'tournament';
    gameState.difficulty = 'hard';
    startGame();
}

// Save tournament progress after game
function updateTournamentResult(win) {
    const tournamentId = Object.keys(userData.tournamentProgress || {})[0];
    if (!tournamentId) return;
    
    const progress = userData.tournamentProgress[tournamentId];
    if (win) {
        progress.wins++;
        progress.round++;
        if (progress.wins >= 3) {
            alert(`Selamat! Anda memenangkan turnamen! +${tournamentId === '1' ? 500 : tournamentId === '2' ? 2000 : 10000} Coin`);
            delete userData.tournamentProgress[tournamentId];
        }
    } else {
        progress.losses++;
        if (progress.losses >= 2) {
            alert('Anda tereliminasi dari turnamen.');
            delete userData.tournamentProgress[tournamentId];
        }
    }
    
    saveUserData();
}
